var report=function(X,Y,Z){function O(a){"#"===a.charAt(0)&&(a=a.substring(1,7));return(parseInt(a.substring(0,2),16)+parseInt(a.substring(2,4),16)+parseInt(a.substring(4,6),16))/3}function h(a,c){return"undefined"!==typeof a&&null!==a?a:c}function F(a,c){var d=f.internal.pageSize.height-b.template.margins["bottom-margin"];a<f.internal.pageSize.height-b.template.page.footer_height-b.template.margins["bottom-margin"]&&(d-=b.template.page.footer_height);return a+c>d?!0:!1}function C(a){function c(a){-1<
a.indexOf("{{page}}")&&(a=a.replace("{{page}}",b.template.page.current_page.toString()));var c=a.split(".");if("undefined"!==typeof b.template.elements.data[c[0]])if("object"===typeof b.template.elements.data[c[0]])if(Array.isArray(b.template.elements.data[c[0]]))try{return null!==b.template.elements.data[c[0]][parseInt(c[1])][c[2]]?b.template.elements.data[c[0]][parseInt(c[1])][c[2]].toString():""}catch(d){return a}else try{return null!==b.template.elements.data[c[0]][c[1]]?b.template.elements.data[c[0]][c[1]].toString():
""}catch(f){return a}else return null!==b.template.elements.data[c[0]]?b.template.elements.data[c[0]].toString():"";else return a}if(-1<a.indexOf("={{")&&-1<a.indexOf("}}")){var d=a.substring(a.indexOf("={{")+3,a.indexOf("}}"));a=a.replace("={{"+d+"}}",c(d));return-1<a.indexOf("={{")&&-1<a.indexOf("}}")?C(a):a}return c(a)}function P(a,c){if(-1<a.indexOf("={{")&&-1<a.indexOf("}}")){var d=a.substring(a.indexOf("={{"),a.indexOf("}}")+2),e=C(d);a=a.replace(d,e);b.template.xml.details+="\n    <"+c.toString()+
"><![CDATA["+e.toString()+"]]\x3e</"+c.toString()+">";if(-1<a.indexOf("={{")&&-1<a.indexOf("}}"))P(a,c);else return a}else return a}function u(a){return 0<Object.getOwnPropertyNames(a).length?Object.getOwnPropertyNames(a)[0]:null}function I(a,c){if("undefined"===typeof c||null===c)c={};c["font-family"]=h(a["font-family"],null);c["font-style"]=h(a["font-style"],null);c["font-size"]=h(a["font-size"],null);c.color=h(a.color,null);c["border-color"]=h(a["border-color"],null);c["background-color"]=h(a["background-color"],
null);return c}function D(a){f.setFont(b.template.style["font-family"]);"undefined"!==typeof a["font-family"]&&null!==a["font-family"]&&f.setFont(a["font-family"]);f.setFontType(b.template.style["font-style"]);"undefined"!==typeof a["font-style"]&&null!==a["font-style"]&&f.setFontType(a["font-style"]);f.setFontSize(b.template.style["font-size"]);"undefined"!==typeof a["font-size"]&&null!==a["font-size"]&&f.setFontSize(a["font-size"]);if("undefined"===typeof a.color||null===a.color)a.color=b.template.style.color;
f.setTextColor(a.color);if("undefined"===typeof a["background-color"]||null===a["background-color"])a["background-color"]=b.template.style["background-color"];f.setFillColor(a["background-color"]);if("undefined"===typeof a["border-color"]||null===a["border-color"])a["border-color"]=b.template.style["border-color"];f.setDrawColor(a["border-color"])}function Q(a,c,b,e){a=isFinite(+a)?+a:0;c=isFinite(+c)?Math.abs(c):0;e="undefined"===typeof e?",":e;b="undefined"===typeof b?".":b;var g=function(a,c){var b=
Math.pow(10,c);return Math.round(a*b)/b};a=(c?g(a,c):Math.round(a)).toString().split(".");3<a[0].length&&(a[0]=a[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,e));(a[1]||"").length<c&&(a[1]=a[1]||"",a[1]+=Array(c-a[1].length+1).join("0"));return a.join(b)}function G(a,c,b,e){f.setFontType(null===e?"normal":e);a=f.splitTextToSize(a,c-2*b);return{text:a,height:f.internal.getLineHeight()/f.internal.scaleFactor*a.length+b}}function R(a){var c={width:0,height:0},b=document.createElement("img");b.id="pimg";b.src=
a;document.body.appendChild(b);c.width=b.width/f.internal.scaleFactor;c.height=b.height/f.internal.scaleFactor;document.body.removeChild(b);return c}function S(){for(var a=b.template.elements.header,c=0;c<a.length;c++){var d=u(a[c]);switch(d){case "row":case "vgap":case "hline":J("header",d,a[c][d])}}}function T(){for(var a=b.template.elements.footer,c=0;c<a.length;c++){var d=u(a[c]);switch(d){case "row":case "vgap":case "hline":J("footer",d,a[c][d])}}}function J(a,c,d){var e={};switch(c){case "row":$(a,
d);break;case "vgap":d=h(d.height,0);0<d&&(F(b.template.page.cursor.y,d)?f.addPage():b.template.page.cursor.y+=d);break;case "hline":a=parseFloat(h(d.width,0));c=h(d.gap,0);0===a&&(a=f.internal.pageSize.width-b.template.margins["left-margin"]-b.template.margins["right-margin"]);"undefined"!==typeof d["border-color"]&&(e={"border-color":d["border-color"]},D(e));f.line(b.template.page.cursor.x,b.template.page.cursor.y,b.template.page.cursor.x+a,b.template.page.cursor.y);0<c&&f.line(b.template.page.cursor.x,
b.template.page.cursor.y+c,b.template.page.cursor.x+a,b.template.page.cursor.y+c);b.template.page.cursor.x=b.template.margins["left-margin"];b.template.page.cursor.y+=1+c;break;case "html":a=d.html;c=h(d.fieldname,"head");e=I(d);D(e);f.text("",0,0);a=P(a,c);f.fromHTML(a,b.template.page.cursor.x,b.template.page.cursor.y,{width:f.internal.pageSize.width-b.template.margins["left-margin"]-b.template.margins["right-margin"],elementHandlers:function(){}},function(a){b.template.page.cursor.x=b.template.margins["left-margin"];
b.template.page.cursor.y=a.y;return!0},{top:b.template.margins["top-margin"]+b.template.page.header_height,bottom:b.template.margins["bottom-margin"]+b.template.page.footer_height});break;case "datagrid":aa(d)}return!0}function aa(a){var c=h(a.databind,null);if(null===c)return!0;c=b.template.elements.data[c];if("undefined"===typeof c||0===c.length)return!0;var d=I(a);d.xname=h(a.name,"items");d.border=h(a.border,"1");var e={"font-size":d["font-size"],color:d.color,"border-color":d["border-color"],
border:d.border,merge:0,"font-style":"bold",text:"",height:0,columns:[],columns_width:0,grid_width:h(a.width,"100%")};e.merge=h(a.merge,0);e["background-color"]=h(a["header-background"],null);var g=f.internal.pageSize.width-b.template.margins["right-margin"]-b.template.margins["left-margin"];-1<e.grid_width.indexOf("%")?e.grid_width=g*(parseFloat(e.grid_width.replace("%",""))/100):(e.grid_width=parseFloat(e.grid_width),e.grid_width>g&&(e.grid_width=g));var q={"font-size":d["font-size"],color:d.color,
"border-color":d["border-color"],border:d.border,"font-style":"bold",text:"",height:0};q["background-color"]=h(a["footer-background"],null);e.extend=d.extend=q.extend=e.grid_width===g;var n=[],g=0;if(0<a.columns.length){a=a.columns;for(var k=0;k<a.length;k++){var l=a[k].column;if(e.columns_width>=e.grid_width)return!1;var m={"font-size":d["font-size"],color:d.color,"border-color":d["border-color"],border:d.border};m.fieldname=h(l.fieldname,"");m.label=C(h(l.label,""));if(0===e.merge){m.width=h(l.width,
null);null!==m.width?-1<m.width.toString().indexOf("%")?m.width=e.grid_width*(parseFloat(m.width.replace("%",""))/100):m.width=parseFloat(m.width):m.width=parseFloat(f.getStringUnitWidth(m.label)*f.internal.getFontSize()/f.internal.scaleFactor+2*b.template.page.padding)+1;e.columns_width+m.width>=e.grid_width&&(m.width=e.grid_width-e.columns_width);e.columns_width+=m.width;var p=G(m.label,m.width,b.template.page.padding,e["font-style"]).height;p>e.height&&(e.height=p)}m.header_align=h(l["header-align"],
"left");m.align=h(l.align,"left");m.multiline="left"===m.align?"true":"false";if("undefined"!==typeof l.thousands||"undefined"!==l.digit||"undefined"!==typeof l.decpoint)m.numbercol=!0,m.thousands=h(l.thousands,""),m.digit=h(l.digit,0),m.decpoint=h(l.decpoint,".");var p=C(h(l.footer,"")),r=h(l["footer-align"],"left");m.numbercol&&!isNaN(+p)&&isFinite(p)&&(p=Q(p,m.digit,m.decpoint,m.thousands));""!==h(l.footer,"")?(0===n.length?n.push({text:p,align:r,width:g+m.width}):(n[n.length-1].width+=g,n.push({text:p,
align:r,width:m.width})),g=0):g+=m.width;m.ln=a.length-1===k?1:0;e.columns.push(m)}}else return!0;0===e.merge&&U(e);c.forEach(function(a,c){b.template.xml.details+="\n    <"+d.xname.toString()+">";d.height=0;d.text="";e.columns.forEach(function(g){g.text="counter"===g.fieldname?(c+1).toString():"undefined"!==typeof a[g.fieldname]&&null!==a[g.fieldname]?a[g.fieldname]:"";g.numbercol&&!isNaN(+g.text)&&isFinite(g.text)&&""!==g.text&&(g.text=Q(g.text,g.digit,g.decpoint,g.thousands));0===e.merge?(g=G(g.text,
g.width,b.template.page.padding,d["font-style"]).height,g>d.height&&(d.height=g)):(d.text+=" "+g.text,b.template.xml.details+="\n      <"+g.fieldname.toString()+"><![CDATA["+g.text.toString()+"]]\x3e</"+g.fieldname.toString()+">")});0===e.merge?e.columns.forEach(function(a){d.text=a.text;d.width=a.width;d.align=a.align;d.ln=a.ln;d.multiline=a.multiline;E(d,e);b.template.xml.details+="\n      <"+a.fieldname.toString()+"><![CDATA["+a.text.toString()+"]]\x3e</"+a.fieldname.toString()+">"}):(d.text=d.text.trim(),
d.width=null,d.ln=1,d.multiline="true",d.height=null,E(d));b.template.xml.details+="\n    </"+d.xname.toString()+">"});0===e.merge&&(n.forEach(function(a){a=G(a.text,a.width,b.template.page.padding,q["font-style"]).height;a>q.height&&(q.height=a)}),n.forEach(function(a,c){q.text=a.text;q.width=a.width;q.align=a.align;q.multiline="left"===q.align?"true":"false";q.ln=n.length-1===c?1:0;E(q,e);b.template.xml.details+="\n    <"+d.xname.toString()+"_footer><![CDATA["+a.text.toString()+"]]\x3e</"+d.xname.toString()+
"_footer>"}))}function U(a){a.height=0;a.x=null;a.y=null;a.columns.forEach(function(c){0===a.merge?(a.text=c.label,a.ln=c.ln,0===c.width&&(c.width=(a.grid_width-a.columns_width)/a.columns.length),a.width=c.width):a.text+=" "+c.label;a.align=c.header_align;a.multiline="left"===a.align?"true":"false";E(a,a);a.width>c.width&&(c.width=a.width)})}function E(a,c){D(a);if("undefined"===typeof a.text||null===a.text)a.text="";a.x="undefined"===typeof a.x||null===a.x?parseFloat(b.template.page.cursor.x):parseFloat(a.x);
a.y="undefined"===typeof a.y||null===a.y?parseFloat(b.template.page.cursor.y):parseFloat(a.y);a.padding="undefined"===typeof a.padding||null===a.padding?parseInt(b.template.page.padding):parseInt(a.padding);if("undefined"===typeof a.multiline||null===a.multiline)a.multiline="false";a.ln="undefined"===typeof a.ln||null===a.ln?0:parseInt(a.ln);0<a.ln&&a.extend?a.width=f.internal.pageSize.width-b.template.margins["right-margin"]-a.x:("undefined"===typeof a.width||null===a.width?a.width=parseFloat(f.getStringUnitWidth(a.text)*
f.internal.getFontSize()/f.internal.scaleFactor+2*a.padding)+1:-1<a.width.toString().indexOf("%")?a.width=(f.internal.pageSize.width-b.template.margins["right-margin"]-b.template.margins["left-margin"])*(parseFloat(a.width.toString().replace("%",""))/100):a.width=parseFloat(a.width),a.x+a.padding+a.width>f.internal.pageSize.width-b.template.margins["right-margin"]&&(a.width=f.internal.pageSize.width-b.template.margins["right-margin"]-a.x));0>a.width&&(a.width=0,a.text="");var d=parseFloat(f.internal.getLineHeight()/
f.internal.scaleFactor)+a.padding;"undefined"===typeof a.height||null===a.height?a.height=d:d>parseFloat(a.height)?a.height=d:a.height=parseFloat(a.height);"true"==a.multiline&&""!==a.text&&(d=G(a.text,a.width,a.padding,a["font-style"]),a.text=d.text,d.height>a.height&&(a.height=d.height));F(a.y,a.height)&&(f.addPage(),"undefined"!==typeof c&&(U(c),a.x=parseFloat(b.template.page.cursor.x)),D(a),a.y=parseFloat(b.template.page.cursor.y));"undefined"!==typeof a["background-color"]&&null!==a["background-color"]&&
f.rect(a.x,a.y,a.width,a.height,"F");"undefined"!==typeof a.border&&null!==a.border&&("1"===a.border?f.rect(a.x,a.y,a.width,a.height):(-1<a.border.indexOf("L")&&f.line(a.x,a.y,a.x,a.y+a.height),-1<a.border.indexOf("R")&&f.line(a.x+a.width,a.y,a.x+a.width,a.y+a.height),-1<a.border.indexOf("T")&&f.line(a.x,a.y,a.x+a.width,a.y),-1<a.border.indexOf("B")&&f.line(a.x,a.y+a.height,a.x+a.width,a.y+a.height)));d=a.x+a.padding;if("undefined"===typeof a.align||null===a.align)a.align="left";if("false"==a.multiline){switch(a.align){case "right":d=
a.x+(a.width-parseFloat(f.getStringUnitWidth(a.text)*f.internal.getFontSize()/f.internal.scaleFactor)-a.padding);break;case "center":d=a.x+(a.width-parseFloat(f.getStringUnitWidth(a.text)*f.internal.getFontSize()/f.internal.scaleFactor))/2;break;default:d=a.x+a.padding}f.text(a.text,d,a.y+(.5*a.height+.3*f.internal.getFontSize()/f.internal.scaleFactor))}else for(var e=0;e<a.text.length;e++)f.text(a.text[e],d,a.y+f.internal.getLineHeight()/f.internal.scaleFactor*(e+1));0<a.ln?(a.y+=a.height,1===a.ln&&
(a.x=b.template.margins["left-margin"])):a.x+=a.width;b.template.page.cursor.x=a.x;b.template.page.cursor.y=a.y;return!0}function $(a,c){var d=h(c.visible,"");if(""!==d&&("undefined"===typeof b.template.elements.data[d]||0===b.template.elements.data[d].length))return"";for(var d=h(c.hgap,0),e=h(c.height,null),g=e,q=0;q<c.columns.length;q++){b.template.page.cursor.x!==b.template.margins["left-margin"]&&(b.template.page.cursor.x+=parseFloat(d));var n=u(c.columns[q]),k=c.columns[q][n];switch(n){case "cell":var l=
{height:e},l=I(k,l);l.text=C(h(k.value,""));l.width=h(k.width,null);l.border=h(k.border,null);l.align=h(k.align,"left");l.ln=c.columns.length-1===q?1:0;l.multiline="false";l.extend=!0;"details"===a&&(l.multiline=h(k.multiline,"false"));E(l);if(l.height>g||null===g)g=l.height;k=h(k.name,"head");"header"===a&&"label"!==k&&(b.template.xml.header+="\n    <"+k.toString()+"><![CDATA["+l.text.toString()+"]]\x3e</"+k.toString()+">");"details"===a&&"label"!==k&&(b.template.xml.details+="\n    <"+k.toString()+
"><![CDATA["+l.text.toString()+"]]\x3e</"+k.toString()+">");break;case "image":l=h(k.src,null);if(null!==l&&("data:image"!==l.toString().substr(0,10)&&(l=C(l)),"data:image"===l.toString().substr(0,10))){var m=parseFloat(h(k.width,0)),p=h(k.height,0);if(0===p||0===m)p=R(l),m=p.width,p=p.height;k=h(k.compression,"medium");F(b.template.page.cursor.y,p)&&f.addPage();f.addImage(l,null,b.template.page.cursor.x,b.template.page.cursor.y,m,p,null,k);b.template.page.cursor.x+=m;if(g<p||null===g)g=p}break;case "barcode":var l=
h(k["code-type"],"code39"),r=h(k.value,""),p=h(k["visible-value"],0),s=h(k.wide,K(l,"wide")),k=m=h(k.wide,K(l,"narrow"));1===p&&(k=m+f.internal.getFontSize()/f.internal.scaleFactor);F(b.template.page.cursor.y,k)&&f.addPage();switch(l){case "code39":var l=r,r=(r=s)||1.5,m=m||5,p=p||!1,s=r/3,z=r,t=s,x=l.toUpperCase();f.setFontSize(10);f.setTextColor(0);var r=b.template.page.cursor.x,A={0:"nnnwwnwnn",1:"wnnwnnnnw",2:"nnwwnnnnw",3:"wnwwnnnnn",4:"nnnwwnnnw",5:"wnnwwnnnn",6:"nnwwwnnnn",7:"nnnwnnwnw",8:"wnnwnnwnn",
9:"nnwwnnwnn",A:"wnnnnwnnw",B:"nnwnnwnnw",C:"wnwnnwnnn",D:"nnnnwwnnw",E:"wnnnwwnnn",F:"nnwnwwnnn",G:"nnnnnwwnw",H:"wnnnnwwnn",I:"nnwnnwwnn",J:"nnnnwwwnn",K:"wnnnnnnww",L:"nnwnnnnww",M:"wnwnnnnwn",N:"nnnnwnnww",O:"wnnnwnnwn",P:"nnwnwnnwn",Q:"nnnnnnwww",R:"wnnnnnwwn",S:"nnwnnnwwn",T:"nnnnwnwwn",U:"wwnnnnnnw",V:"nwwnnnnnw",W:"wwwnnnnnn",X:"nwnnwnnnw",Y:"wwnnwnnnn",Z:"nwwnwnnnn","-":"nwnnnnwnw",".":"wwnnnnwnn"," ":"nwwnnnwnn","*":"nwnnwnwnn",$:"nwnwnwnnn","/":"nwnwnnnwn","+":"nwnnnwnwn","%":"nnnwnwnwn"};
if(V(A,l)){for(var B=0;B<x.length;B+=2){for(var v=x[B],w="",y=0;y<A[v].length;y++)w+=A[v][y];for(v=0;v<w.length;v++)y="n"===w[v]?s:z,0===v%2&&f.rect(b.template.page.cursor.x,b.template.page.cursor.y,y,m,"F"),b.template.page.cursor.x+=y}b.template.page.cursor.x+=t;p&&(p=parseFloat(f.getStringUnitWidth(l)*f.internal.getFontSize()/f.internal.scaleFactor),r+=(b.template.page.cursor.x-r-p)/2,f.text(l,r,b.template.page.cursor.y+m+f.internal.getFontSize()/f.internal.scaleFactor))}else l="Invalid barcode: "+
l,b.template.page.cursor.x+=b.template.page.padding,f.text(l,b.template.page.cursor.x,b.template.page.cursor.y+f.internal.getLineHeight()/f.internal.scaleFactor),b.template.page.cursor.x+=parseFloat(f.getStringUnitWidth(l)*f.internal.getFontSize()/f.internal.scaleFactor),b.template.page.cursor.x+=b.template.page.padding;break;case "i2of5":if(l=r,r=(r=s)||1,m=m||10,p=p||!1,s=r/3,z=r,f.setFontSize(10),f.setTextColor(0),r=b.template.page.cursor.x,t={0:"nnwwn",1:"wnnnw",2:"nwnnw",3:"wwnnn",4:"nnwnw",
5:"wnwnn",6:"nwwnn",7:"nnnww",8:"wnnwn",9:"nwnwn",A:"nn",Z:"wn"},V(t,l)){x=l;0!==x.length%2&&(x="0"+x);x="AA"+x.toLocaleLowerCase()+"ZA";for(A=0;A<x.length;A+=2){w=x[A];v=x[A+1];B="";for(y=0;y<t[w].length;y++)B+=t[w][y]+t[v][y];for(w=0;w<B.length;w++)v="n"===B[w]?s:z,0===w%2&&f.rect(b.template.page.cursor.x,b.template.page.cursor.y,v,m,"F"),b.template.page.cursor.x+=v}p&&(p=parseFloat(f.getStringUnitWidth(l)*f.internal.getFontSize()/f.internal.scaleFactor),r+=(b.template.page.cursor.x-r-p)/2,f.text(l,
r,b.template.page.cursor.y+m+f.internal.getFontSize()/f.internal.scaleFactor))}else l="Invalid barcode: "+l,b.template.page.cursor.x+=b.template.page.padding,f.text(l,b.template.page.cursor.x,b.template.page.cursor.y+f.internal.getLineHeight()/f.internal.scaleFactor),b.template.page.cursor.x+=parseFloat(f.getStringUnitWidth(l)*f.internal.getFontSize()/f.internal.scaleFactor),b.template.page.cursor.x+=b.template.page.padding}if(g<k||null===g)g=k;break;case "separator":null!==g&&(k=h(k.gap,0),f.line(b.template.page.cursor.x+
k,b.template.page.cursor.y,b.template.page.cursor.x+k,b.template.page.cursor.y+parseFloat(g)),c.columns.length-1<q&&(b.template.page.cursor.x+=k))}"cell"!==n&&c.columns.length-1===q&&(b.template.page.cursor.y+=g,b.template.page.cursor.x=b.template.margins["left-margin"])}return!0}function K(a,c){switch(a){case "code39":return"wide"===c?1.5:5;case "i2of5":return"wide"===c?1:10}return 0}function V(a,c){for(var b=0;b<c.toString().length;b++)if(!a.hasOwnProperty(c[b]))return!1;return!0}function s(a,c){switch(a){case "format":c=
h(c,"a4");switch(c){case "a3":case "a4":case "a5":case "letter":case "legal":break;default:c="a4"}return c;case "orientation":c=h(c,"p");switch(c){case "p":case "portrait":case "l":case "landscape":break;default:c="p"}return c;case "unit":c=h(c,"mm");switch(c){case "pt":case "mm":case "cm":case "in":break;default:c="mm"}return c;case "author":case "creator":case "subject":case "title":return c=h(c,b.template.document[a]);case "font-size":case "digit":c=parseInt(h(c,null));if(!isNaN(c))return parseInt(h(c,
null));break;case "left-margin":case "right-margin":case "top-margin":case "bottom-margin":case "height":case "gap":case "hgap":case "wide":case "narrow":c=parseFloat(h(c,null));if(!isNaN(c))return parseFloat(h(c,null));break;case "src":case "value":case "name":case "databind":case "label":case "fieldname":case "thousands":case "footer":case "decpoint":case "width":case "visible":case "border":case "html":case "code-type":return c;case "merge":case "visible-value":return c=parseInt(h(c,0)),0!==c?
1:c;case "multiline":return c=h(c,"false"),"false"!==c?"true":c;case "compression":c=h(c,"medium");switch(c){case "fast":case "medium":case "slow":break;default:c="medium"}return c;case "align":case "header-align":case "footer-align":switch(c=h(c,"left"),c){case "R":return"right";case "C":return"center";case "left":case "center":case "right":return c;default:return"left"}case "font-family":c=h(c,null);if("times"!==c||"helvetica"!==c||"courier"!==c)c="times";return c;case "font-style":c=h(c,null);
if(null!==c){switch(c){case "B":c="bold";break;case "I":c="italic";break;case "BI":case "IB":c="bolditalic";break;case "bold":case "italic":case "bolditalic":case "normal":break;default:c="normal"}return c}break;case "color":c=h(c,null);if(null!==c)if("#"!==c.toString().charAt(0)){if(!isNaN(parseInt(c)))return c="#"+parseInt(c).toString(16).toUpperCase()}else return c;break;case "border-color":case "background-color":case "footer-background":case "header-background":if(c=h(c,null),null!==c){if("#"===
c.toString().charAt(0))return c=O(c);if(!isNaN(parseInt(c)))return 255<parseInt(c)&&(c=O(parseInt(c).toString(16).toUpperCase())),parseInt(c)}}return null}function z(a,c){for(var b=0;b<a.attributes.length;b++){var e=s(a.attributes[b].name,a.attributes[b].value);null!==e&&(c[a.attributes[b].name]=e)}}function L(a,c){for(var d=0;d<c.childNodes.length;d++)switch(c.childNodes[d].nodeName){case "row":var e=c.childNodes[d],g={};g[c.childNodes[d].nodeName]={columns:[]};z(e,g[c.childNodes[d].nodeName]);for(var e=
e.childNodes,f=0;f<e.length;f++)"#text"!==e[f].nodeName&&(e=e[f]);for(f=0;f<e.childNodes.length;f++)switch(e.childNodes[f].nodeName){case "cell":case "image":case "barcode":case "separator":var h={};h[e.childNodes[f].nodeName]={};z(e.childNodes[f],h[e.childNodes[f].nodeName]);g[c.childNodes[d].nodeName].columns.push(h)}b.template.elements[a].push(g);break;case "datagrid":g=c.childNodes[d];e={};e[c.childNodes[d].nodeName]={columns:[]};z(g,e[c.childNodes[d].nodeName]);for(f=0;f<g.childNodes.length;f++)switch(g.childNodes[f].nodeName){case "header":case "footer":h=
s("background-color",g.childNodes[f].attributes["background-color"].value);null!==h&&(e[c.childNodes[d].nodeName][g.childNodes[f].nodeName+"_background"]=h);break;case "columns":for(var h=g.childNodes[f],k=0;k<h.childNodes.length;k++)if("column"===h.childNodes[k].nodeName){var l={};l[h.childNodes[k].nodeName]={};z(h.childNodes[k],l[h.childNodes[k].nodeName]);e[c.childNodes[d].nodeName].columns.push(l)}}b.template.elements[a].push(e);break;case "html":g={};g[c.childNodes[d].nodeName]={};z(c.childNodes[d],
g[c.childNodes[d].nodeName]);g[c.childNodes[d].nodeName].html=c.childNodes[d].textContent||"";b.template.elements[a].push(g);break;case "vgap":case "hline":g={},g[c.childNodes[d].nodeName]={},z(c.childNodes[d],g[c.childNodes[d].nodeName]),b.template.elements[a].push(g)}}function t(a,c){for(var b=0;b<Object.keys(a).length;b++){var e=Object.keys(a)[b],g=s(e,a[e]);null!==g&&(c[e]=g)}}function M(a,c){for(var d=0;d<c.length;d++){var e=u(c[d]);switch(e){case "row":var g=c[d][e],f={};f[e]={columns:[]};t(g,
f[e]);for(var h=0;h<g.columns.length;h++){var k=u(g.columns[h]),l={};l[k]={};t(g.columns[h][k],l[k]);f[e].columns.push(l)}b.template.elements[a].push(f);break;case "datagrid":g=c[d][e];f={};f[e]={columns:[]};t(g,f[e]);for(e=0;e<g.columns.length;e++)h={column:{}},t(g.columns[e].column,h.column),f.datagrid.columns.push(h);b.template.elements[a].push(f);break;case "html":g={};g[e]={};t(c[d][e],g[e]);g[e].html=c[d][e].html;b.template.elements[a].push(g);break;case "vgap":case "hline":g={},g[e]={},t(c[d][e],
g[e]),b.template.elements[a].push(g)}}}function N(a,c){for(var b=0;b<c.length;b++){if(a===c[b])return c;var e=u(c[b]);if("row"===e||"datagrid"===e)for(var g=0;g<c[b][e].columns.length;g++)if(a===c[b][e].columns[g])return c[b][e].columns}return null}function H(a,c,b){for(var e=0;e<a.length;e++)for(var g=u(a[e]),f=b.appendChild(c.createElement(g)),h=0;h<Object.keys(a[e][g]).length;h++){var k=Object.keys(a[e][g])[h],l=a[e][g][k];"object"===typeof l?Array.isArray(l)?(k=f.appendChild(c.createElement(k)),
H(l,c,k)):f.setAttribute(k,l):"html"===k?f.appendChild(c.createCDATASection(l)):f.setAttribute(k,l)}}function W(){b.template.document.author=b.template.elements.report.author||b.template.document.author;b.template.document.creator=b.template.elements.report.creator||b.template.document.creator;b.template.document.subject=b.template.elements.report.subject||b.template.document.subject;b.template.document.title=b.template.elements.report.title||b.template.document.title;"undefined"!==typeof b.template.elements.report["font-family"]&&
(b.template.style["font-family"]=b.template.elements.report["font-family"]);"undefined"!==typeof b.template.elements.report["font-style"]&&(b.template.style["font-style"]=b.template.elements.report["font-style"]);"undefined"!==typeof b.template.elements.report["font-size"]&&(b.template.style["font-size"]=b.template.elements.report["font-size"]);"undefined"!==typeof b.template.elements.report.color&&(b.template.style.color=b.template.elements.report.color);"undefined"!==typeof b.template.elements.report["border-color"]&&
(b.template.style["border-color"]=b.template.elements.report["border-color"]);"undefined"!==typeof b.template.elements.report["background-color"]&&(b.template.style["background-color"]=b.template.elements.report["background-color"]);b.template.margins["left-margin"]=b.template.elements.report["left-margin"]||b.template.margins["left-margin"];b.template.margins["right-margin"]=b.template.elements.report["right-margin"]||b.template.margins["right-margin"];b.template.margins["top-margin"]=b.template.elements.report["top-margin"]||
b.template.margins["top-margin"];b.template.margins["bottom-margin"]=b.template.elements.report["bottom-margin"]||b.template.margins["bottom-margin"]}var b=this;b.orientation=s("orientation",X);b.unit=s("unit",Y);b.format=s("format",Z);b.template={document:{title:"Nervatura Report",author:"",creator:"",subject:"",keywords:""},margins:{"left-margin":12,"top-margin":12,"right-margin":12,"bottom-margin":12},style:{"font-family":"times","font-style":"normal","font-size":12,color:"#000000","border-color":0,
"background-color":255},elements:{report:{},header:[],details:[],footer:[],data:{}},xml:{header:"",details:""},page:{cursor:{x:0,y:0},padding:2,header_height:0,footer_height:0,current_page:1}};var f=new jsPDF({orientation:b.orientation,unit:b.unit,format:b.format,textColor:b.template.style.color,drawColor:b.template.style["border-color"],fontSize:b.template.style["font-size"]});f.internal.events.subscribe("addPage",function(a){b.template.page.current_page=a.pageNumber;a=b.template.page.footer_height;
b.template.page.footer_height=0;b.template.page.cursor.y=f.internal.pageSize.height-b.template.margins["bottom-margin"]-a;T();b.template.page.cursor.y=b.template.margins["top-margin"];b.template.page.footer_height=a;S();b.template.page.cursor.x=b.template.margins["left-margin"];b.template.page.cursor.y=b.template.margins["top-margin"]+b.template.page.header_height});b.loadJsonDefinition=function(a){if(null===a||""===a||"undefined"===typeof a)return!0;"string"===typeof a&&(a=JSON.parse(a));b.template.elements=
{report:{},header:[],details:[],footer:[],data:{}};b.template.element_matrix=[];"undefined"!==typeof a.report&&t(a.report,b.template.elements.report);"undefined"!==typeof a.header&&M("header",a.header);"undefined"!==typeof a.details&&M("details",a.details);"undefined"!==typeof a.footer&&M("footer",a.footer);if("undefined"!==typeof a.data)for(var c=b.template.elements.data,d=0;d<Object.keys(a.data).length;d++){var e=Object.keys(a.data)[d];if("object"===typeof a.data[e])if(Array.isArray(a.data[e])){c[e]=
[];for(var g=0;g<a.data[e].length;g++){for(var f={},h=0;h<Object.keys(a.data[e][g]).length;h++)f[Object.keys(a.data[e][g])[h]]=a.data[e][g][Object.keys(a.data[e][g])[h]];c[e].push(f)}}else for(c[e]={},g=0;g<Object.keys(a.data[e]).length;g++)c[e][Object.keys(a.data[e])[g]]=a.data[e][Object.keys(a.data[e])[g]];else c[e]=a.data[e]}W();return!0};b.loadDefinition=function(a){if(null!==a&&""!==a&&"string"===typeof a){b.template.elements={report:{},header:[],details:[],footer:[],data:{}};b.template.element_matrix=
[];var c=(new DOMParser).parseFromString(a,"application/xml");0<c.getElementsByTagName("report").length&&z(c.getElementsByTagName("report")[0],b.template.elements.report);0<c.getElementsByTagName("header").length&&L("header",c.getElementsByTagName("header")[0]);0<c.getElementsByTagName("details").length&&L("details",c.getElementsByTagName("details")[0]);0<c.getElementsByTagName("footer").length&&L("footer",c.getElementsByTagName("footer")[0]);if(0<c.getElementsByTagName("data").length){a=b.template.elements.data;
for(var c=c.getElementsByTagName("data")[0],d=0;d<c.childNodes.length;d++)if("#text"!==c.childNodes[d].nodeName)if(0<c.childNodes[d].childNodes.length)if(1===c.childNodes[d].childNodes.length&&"#text"===c.childNodes[d].childNodes[0].nodeName)a[c.childNodes[d].nodeName]=c.childNodes[d].childNodes[0].textContent;else if(1===c.childNodes[d].childNodes.length&&"#cdata-section"===c.childNodes[d].childNodes[0].nodeName)a[c.childNodes[d].nodeName]=c.childNodes[d].childNodes[0].data;else{a[c.childNodes[d].nodeName]=
[];for(var e=0;e<c.childNodes[d].childNodes.length;e++)if("#text"!==c.childNodes[d].childNodes[e].nodeName){for(var f=c.childNodes[d].childNodes[e],h={},n=0;n<f.attributes.length;n++)h[f.attributes[n].nodeName]=f.attributes[n].value;a[c.childNodes[d].nodeName].push(h)}}else if(0<c.childNodes[d].attributes.length)for(a[c.childNodes[d].nodeName]={},e=0;e<c.childNodes[d].attributes.length;e++)a[c.childNodes[d].nodeName][c.childNodes[d].attributes[e].name]=c.childNodes[d].attributes[e].value;else b.template.elements.data[c.childNodes[d].nodeName]=
c.childNodes[d].textContent}W();return!0}return!1};b.setData=function(a,c){b.template.elements.data[a]=c;return!0};b.getData=function(a){return b.template.elements.data[a]};b.createReport=function(){if(0<b.template.elements.details.length){b.template.page.cursor={x:b.template.margins["left-margin"],y:b.template.margins["top-margin"]};f.setProperties({author:b.template.document.author,creator:b.template.document.creator,subject:b.template.document.subject,title:b.template.document.title});D({});var a;
a=0;for(var c=b.template.elements.footer,d=0;d<c.length;d++){var e=u(c[d]),g=c[d][e];switch(e){case "row":for(var e=h(g.height,0),q=0;q<Object.keys(g.columns).length;q++){var n=u(g.columns[q]),k=g.columns[q][n];switch(n){case "cell":k=h(k.height,null);k=null===k?parseFloat(f.internal.getLineHeight()/f.internal.scaleFactor)+b.template.page.padding:parseFloat(k);k>e&&(e=k);break;case "barcode":var l=h(k["code-type"],"code39"),n=h(k["visible-value"],0),k=h(k.wide,K(l,"narrow"));1===n&&(k+=f.internal.getFontSize()/
f.internal.scaleFactor);k>e&&(e=k);break;case "image":n=h(k.src,null),null!==n&&("data:image"!==n.toString().substr(0,10)&&(n=C(n)),"data:image"===n.toString().substr(0,10)&&(k=h(k.height,0),0===k&&(k=R(n).height),k>e&&(e=k)))}}a+=e;break;case "vgap":a+=h(g.height,0);break;case "hline":a+=1+h(g.gap,0)}}b.template.page.cursor.y=f.internal.pageSize.height-b.template.margins["bottom-margin"]-a;T();b.template.page.cursor.y=b.template.margins["top-margin"];b.template.page.footer_height=a;b.template.page.cursor.x=
b.template.margins["left-margin"];S();b.template.page.header_height=b.template.page.cursor.y-b.template.margins["top-margin"];a=b.template.elements.details;for(c=0;c<a.length;c++)d=u(a[c]),J("details",d,a[c][d])}return!0};b.save2PdfFile=function(a){f.save(a)};b.save2Pdf=function(){return f.output("arraybuffer")};b.save2DataUrl=function(){return f.output("dataurlnewwindow")};b.save2Xml=function(){return"<data>"+b.template.xml.header+b.template.xml.details+"\n</data>"};b.getXmlTemplate=function(){for(var a=
(new DOMParser).parseFromString("<template><report /><header></header><details></details><footer></footer><data></data></template>","application/xml"),c=0;c<Object.keys(b.template.elements.report).length;c++){var d=Object.keys(b.template.elements.report)[c];a.getElementsByTagName("report")[0].setAttribute(d,b.template.elements.report[d])}H(b.template.elements.header,a,a.getElementsByTagName("header")[0]);H(b.template.elements.details,a,a.getElementsByTagName("details")[0]);H(b.template.elements.footer,
a,a.getElementsByTagName("footer")[0]);return(new XMLSerializer).serializeToString(a)};b.insertElement=function(a,c,d,e){if("undefined"===typeof a||null===a)a=b.template.elements.details;if("undefined"===typeof c||null===c)c="row";if("undefined"===typeof d||null===d)d=-1;if("undefined"===typeof e||null===e)e={};if("object"===typeof a){if(!Array.isArray(a)){var f=u(a);if("row"===f||"datagrid"===f)a=a[f].columns}}else return null;f={};f[c]={};switch(c){case "row":case "datagrid":f[c].columns=[];break;
case "vgap":case "hline":case "html":case "column":case "cell":case "image":case "barcode":case "separator":break;default:return null}if(d>a.length||0>d)d=a.length;a.splice(d,0,f);for(a=0;a<Object.keys(e).length;a++)d=Object.keys(e)[a],f[c][d]=s(d,e[d]);return f};b.editElement=function(a,c){var b=u(a);if(null!==b){for(var e=0;e<Object.keys(c).length;e++){var f=Object.keys(c)[e];a[b].hasOwnProperty(f)&&null===c[f]?delete a[b][f]:a[b][f]=c[f]}return!0}return!1};b.deleteElement=function(a,c){if("undefined"===
typeof c||null===c){var d=N(a,b.template.elements.details);null===d&&(d=N(a,b.template.elements.header));null===d&&(d=N(a,b.template.elements.footer));c=d}if(null!==c&&!Array.isArray(c))if(d=u(c),"row"===d||"datagrid"===d)c=c[d].columns;else return!1;return null!==c?(d=c.indexOf(a),-1<d&&c.splice(d,1),!0):!1}};